<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" xmlns:th="http://www.w3.org/1999/xhtml">
    <title></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css" />
    <link rel="stylesheet" href="//unpkg.com/layui@2.6.8/dist/css/layui.css">
</head>
<body>
<nav class="ui inverted attached segment m-padded-tb-mini m-shadow-small">
    <div class="ui container">
        <div class="ui inverted secondary stackable menu">
            <h2 class="ui teal header item">卖飞机啊</h2>
            <a th:href="@{/flight/flightList}" class="active m-item item m-mobile-hide"><i class="home icon"></i>航班查询</a>
            <a th:href="@{/order/orderList}" class="m-item item m-mobile-hide"><i class="idea icon"></i>订单信息</a>
            <a href="#" class="m-item item m-mobile-hide"><i class="tags icon"></i>个人中心</a>
            <div class="right m-item m-mobile-hide menu">
                <div class="ui dropdown item">
                    <div class="text">
                        <img class="ui avatar image" src="" style="height: 50px" />
                        王一晨
                    </div>
                    <i class="dropdown icon"></i>
                    <div class="menu">
                        <a href="#" class="item">注销</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>
<br>
<br>
<div class="ui container">
<!--    <form action="#" method="post" class="ui segment form">-->
    <div class="ui form">
        <div class="inline fields">
            <div class="field">
<!--                <div class="ui selection dropdown">-->
<!--                    <input type="hidden" />-->
<!--                    <i class="dropdown icon"></i>-->
<!--                    <div class="default text">出发地</div>-->
<!--                    <div class="menu">-->
<!--                        <div class="item" data-value="1">上海</div>-->
<!--                        <div class="item" data-value="2">北京</div>-->
<!--                    </div>-->
<!--                </div>-->
                <select id="origin" name="origin" lay-verify="">
                    <option value="">请选择一个城市</option>
                    <option value="北京">北京</option>
                    <option value="上海">上海</option>
                    <option value="杭州">杭州</option>
                </select>
            </div>

            <div class="field">
<!--                <div class="ui selection dropdown">-->
<!--                    <input type="hidden" />-->
<!--                    <i class="dropdown icon"></i>-->
<!--                    <div class="default text">目的地</div>-->
<!--                    <div class="menu">-->
<!--                        <div class="item" data-value="1">上海</div>-->
<!--                        <div class="item" data-value="2">北京</div>-->
<!--                    </div>-->
<!--                </div>-->
                <select id="destination" name="destination" lay-verify="">
                    <option value="">请选择一个城市</option>
                    <option value="北京">北京</option>
                    <option value="上海">上海</option>
                    <option value="杭州">杭州</option>
                </select>
            </div>

            <div class="field">
                <input type="text" id="time" name="startTime">
            </div>

            <div class="field">
                <button class="ui mini teal basic button" th:onclick="getData(1)"><i class="search icon"></i>搜索</button>
            </div>
        </div>
<!--    </form>-->
    </div>
    <table class="ui celled compact table">
        <thead style="text-align: center">
        <tr>
            <th></th>
            <th>航班号</th>
            <th>出发地</th>
            <th>目的地</th>
            <th>预计出发时间</th>
            <th>预计到达时间</th>
            <th>剩余票数</th>
            <th>价格</th>
            <th></th>
        </tr>
        </thead>

        <tbody id="tableBody" style="text-align: center">
        </tbody>
        <tfoot>
        <tr>
            <th id="page" colspan="9">
            </th>
        </tr>
        </tfoot>
    </table>

</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script src="//unpkg.com/layui@2.6.8/dist/layui.js"></script>
<script src="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"></script>
<script>

    var layer = layui.layer;

    $('.ui.dropdown').dropdown({
        on : 'hover'
    });

    $(document).ready(function () {
        getData(1);
    });

    layui.use('laydate', function(){
        var laydate = layui.laydate;


        laydate.render({
            elem: '#time' //指定元素
        });
    });


    function getData(pageNum){
        console.log($('#time').val())
        $.ajax({
            url:"/flight/flightList",
            data:{
                "pageNum":pageNum,
                "origin":$('#origin').val(),
                "destination":$('#destination').val(),
                "startTime":$('#time').val()
            },
            type:"post",
            success:function (result) {
                console.log(result)
                var flightList=result.data.list;
                var pageNum = result.data.pageNum;
                var inf='';
                var tf='';
                for(var i = 0; i<flightList.length; i++){
                    var v=flightList[i];
                    inf += "<tr><td>"+ (i+1) +"</td>"+
                        "<td>"+ v.flightNum +"</td>"+
                        "<td>"+ v.origin +"</td>"+
                        "<td>"+ v.destination +"</td>"+
                        "<td>"+ v.startTime +"</td>"+
                        "<td>"+ v.arrivalTime +"</td>"+
                        "<td>"+ v.amount +"</td>"+
                        "<td>"+ v.price +"</td>"+
                        "<td>"+
                        "<button class='ui mini teal button' onclick='book("+v.id+")'>预定</button></td></tr>";
                }
                tf += "<button id='pre' class='ui black basic button' onclick='getData("+(pageNum-1)+")'>上一页</button>"+
                    "<button id='next' class='ui black basic button' onclick='getData("+(pageNum+1)+")'>下一页</button>";
                $("#tableBody").html(inf);
                $("#page").html(tf);
            }
        })
    }

    // function getData(pageNum){
    //     $.ajax({
    //         url:"/flight/flightList?pageNum="+pageNum,
    //         type:"post",
    //         success:function (result) {
    //             console.log(result)
    //             var flightList=result.data.list;
    //             var pageNum = result.data.pageNum;
    //             var inf='';
    //             var tf='';
    //             for(var i = 0; i<flightList.length; i++){
    //                 var v=flightList[i];
    //                 inf += "<tr><td>"+ (i+1) +"</td>"+
    //                         "<td>"+ v.flightNum +"</td>"+
    //                         "<td>"+ v.origin +"</td>"+
    //                         "<td>"+ v.destination +"</td>"+
    //                         "<td>"+ v.startTime +"</td>"+
    //                         "<td>"+ v.arrivalTime +"</td>"+
    //                         "<td>"+ v.amount +"</td>"+
    //                         "<td>"+ v.price +"</td>"+
    //                         "<td>"+
    //                         "<button class='ui mini teal button' onclick='book("+v.id+")'>预定</button></td></tr>";
    //             }
    //             tf += "<button id='pre' class='ui black basic button' onclick='getData("+(pageNum-1)+")'>上一页</button>"+
    //                 "<button id='next' class='ui black basic button' onclick='getData("+(pageNum+1)+")'>下一页</button>";
    //             $("#tableBody").html(inf);
    //             $("#page").html(tf);
    //         }
    //     })
    // }

    function book(id){
        layer.open({
            type:2,
            area:['550px','600px'],
            fixed:false,
            maxmin:true,
            content:"/flight/toBook?id="+id,
        })
    }
</script>
</body>
</html>
